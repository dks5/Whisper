<!DOCTYPE html>
<html lang="ru" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–æ—Ä—è—á–∞—è –¥–∏–∫—Ç–æ–≤–∫–∞ —Å Whisper: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            user-select: none; /* –ó–∞–ø—Ä–µ—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ —Ä–µ—Å–∞–π–∑–µ */
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Å—ã–ª–∫–∏ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .nav-link.active {
            background-color: #1D4ED8; /* bg-blue-700 */
            color: #EFF6FF; /* text-blue-50 */
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞: —É–±—Ä–∞–Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞, –¥–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫ */
        pre {
            white-space: pre-wrap; /* –í–∫–ª—é—á–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫ */
            word-wrap: break-word;   /* –ü–µ—Ä–µ–Ω–æ—Å–∏–º –¥–ª–∏–Ω–Ω—ã–µ —Å–ª–æ–≤–∞, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        }
        /* –°–∫—Ä—ã—Ç–∏–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫–æ–¥–∞ */
        .code-block {
            overflow: hidden;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä—É—á–∫–∏ —Ä–µ—Å–∞–π–∑–∞ */
        .resize-handle {
            cursor: ns-resize;
            height: 10px;
            background-color: #374151; /* bg-gray-700 */
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .resize-handle::after {
            content: '...';
            color: #9CA3AF; /* text-gray-400 */
            font-size: 1.2rem;
            line-height: 0;
            letter-spacing: 2px;
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-200">

    <header class="bg-gray-800/80 backdrop-blur-sm sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <a href="#home" class="text-xl font-bold text-white nav-link-header">Whisper –î–∏–∫—Ç–æ–≤–∫–∞</a>
                <nav class="hidden md:flex space-x-1" id="desktop-nav">
                    <a href="#home" data-target="home" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">–ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="#preparation" data-target="preparation" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</a>
                    <a href="#install-and-run" data-target="install-and-run" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫</a>
                    <a href="#faq" data-target="faq" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">–í–æ–ø—Ä–æ—Å—ã</a>
                </nav>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-gray-300 hover:text-white focus:outline-none">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="md:hidden hidden">
            <a href="#home" data-target="home" class="nav-link block py-2 px-4 text-sm text-gray-300 hover:bg-gray-700">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="#preparation" data-target="preparation" class="nav-link block py-2 px-4 text-sm text-gray-300 hover:bg-gray-700">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</a>
            <a href="#install-and-run" data-target="install-and-run" class="nav-link block py-2 px-4 text-sm text-gray-300 hover:bg-gray-700">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫</a>
            <a href="#faq" data-target="faq" class="nav-link block py-2 px-4 text-sm text-gray-300 hover:bg-gray-700">–í–æ–ø—Ä–æ—Å—ã</a>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8" style="max-width: 1000px;">
        
        <section id="home" class="page-section">
            <div class="bg-gray-800 rounded-lg p-6 shadow-xl">
                <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">–ì–æ—Ä—è—á–∞—è –¥–∏–∫—Ç–æ–≤–∫–∞ —Å Whisper –Ω–∞ Windows</h1>
                <p class="text-lg text-gray-400 mb-6">–£–¥–µ—Ä–∂–∏–≤–∞–µ—Ç–µ –∫–ª–∞–≤–∏—à—É ‚Äî –∏–¥—ë—Ç –∑–∞–ø–∏—Å—å. –û—Ç–ø—É—Å–∫–∞–µ—Ç–µ ‚Äî —Ç–µ–∫—Å—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è –∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–µ –æ–∫–Ω–æ.</p>
                <div class="border-l-4 border-blue-500 bg-gray-900/50 p-4 rounded-r-lg">
                    <h3 class="font-semibold text-white">–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</h3>
                    <ul class="list-disc list-inside mt-2 text-gray-300 space-y-1">
                        <li>–ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫ –±–µ–∑ Microsoft C++ Build Tools</li>
                        <li>100% –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º –¥–ª—è –ø–æ–ª–Ω–æ–π –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏</li>
                        <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞</li>
                        <li>–§–æ–ª–ª–±–µ–∫ —Å GPU –Ω–∞ CPU, –µ—Å–ª–∏ CUDA –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</li>
                        <li>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä—è–º–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="preparation" class="page-section hidden">
            <h2 class="text-2xl font-bold border-b border-gray-700 pb-2 mb-4">1. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –ü–û</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-gray-800 rounded-lg">
                    <thead class="bg-gray-700">
                        <tr>
                            <th class="p-3 text-left text-sm font-semibold tracking-wider">–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</th>
                            <th class="p-3 text-left text-sm font-semibold tracking-wider">–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th class="p-3 text-left text-sm font-semibold tracking-wider">–°—Å—ã–ª–∫–∞</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-700">
                        <tr>
                            <td class="p-3 font-medium">Python ‚â• 3.10 (x64)</td>
                            <td class="p-3 text-gray-400">–û—Å–Ω–æ–≤–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞. <b>–í–∞–∂–Ω–æ:</b> –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Ç–º–µ—Ç—å—Ç–µ "Add Python to PATH".</td>
                            <td class="p-3"><a href="https://www.python.org/downloads/" target="_blank" rel="noopener" class="text-blue-400 hover:underline">python.org</a></td>
                        </tr>
                        <tr>
                            <td class="p-3 font-medium">Git (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</td>
                            <td class="p-3 text-gray-400">–£–¥–æ–±–µ–Ω –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤.</td>
                            <td class="p-3"><a href="https://git-scm.com" target="_blank" rel="noopener" class="text-blue-400 hover:underline">git-scm.com</a></td>
                        </tr>
                        <tr>
                            <td class="p-3 font-medium">NVIDIA CUDA (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</td>
                            <td class="p-3 text-gray-400">–î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –Ω–∞ GPU.</td>
                            <td class="p-3"><a href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="noopener" class="text-blue-400 hover:underline">cuda-downloads</a></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2 class="text-2xl font-bold border-b border-gray-700 pb-2 mb-4 mt-8">2. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è</h2>
            <p class="mb-4 text-gray-300">–í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫ –≤ PowerShell. –û–Ω —Å–æ–∑–¥–∞—Å—Ç –ø–∞–ø–∫—É <code>C:\whisper_hotkey</code> –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç –≤ –Ω–µ–π –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ.</p>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="code-block bg-gray-800 rounded-lg shadow-lg">
                    <div class="relative p-3 border-b border-gray-700 flex justify-between items-center">
                        <span class="text-sm font-medium text-gray-400">PowerShell</span>
                        <button class="copy-btn p-1.5 rounded-full bg-gray-700 hover:bg-gray-600">
                            <svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                        </button>
                    </div>
                    <pre class="p-4 text-sm" style="height: 240px;"><code class="language-powershell"># –ó–∞–¥–∞—ë–º –ø—É—Ç—å –¥–ª—è –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
$dir_path = 'C:\whisper_hotkey'

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–∞–ø–∫–∞
if (-not (Test-Path $dir_path)) {
    Write-Host "–°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é: $dir_path"
    mkdir $dir_path | Out-Null
}

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —ç—Ç—É –ø–∞–ø–∫—É
Set-Location $dir_path

# –°–æ–∑–¥–∞—ë–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –µ–≥–æ –µ—â—ë –Ω–µ—Ç
if (-not (Test-Path '.\venv')) {
    Write-Host "–°–æ–∑–¥–∞—ë–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
    python -m venv venv
}

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
Write-Host "–ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
.\venv\Scripts\Activate.ps1</code></pre>
                    <div class="resize-handle"></div>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 h-fit">
                    <h3 class="font-semibold text-white mb-3">–ü–æ—è—Å–Ω–µ–Ω–∏–µ –∫ —Å–∫—Ä–∏–ø—Ç—É</h3>
                    <p class="text-gray-400 mb-3 text-sm">–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç PowerShell —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω —Ç–∞–∫, —á—Ç–æ–±—ã –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞. –í–æ—Ç –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –µ–≥–æ —Ä–∞–±–æ—Ç—ã:</p>
                    <ul class="list-disc list-inside space-y-2 text-gray-400 text-sm">
                        <li><b>–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:</b> –ö–æ–º–∞–Ω–¥–∞ <code>Test-Path</code> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. –ï—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Å–∫—Ä–∏–ø—Ç –µ—ë —Å–æ–∑–¥–∞—ë—Ç.</li>
                        <li><b>–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π:</b> –í –∫–æ–Ω—Å–æ–ª—å –≤—ã–≤–æ–¥—è—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Ö–æ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞.</li>
                        <li><b>–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:</b> –°—Ü–µ–Ω–∞—Ä–∏–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ –∏—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –æ–Ω –ø–ª–∞–≤–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è.</li>
                    </ul>
                </div>
            </div>

            <h2 class="text-2xl font-bold border-b border-gray-700 pb-2 mb-4 mt-8">3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–∞</h2>
            <p class="mb-4 text-gray-300">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø–∞–Ω–µ–ª–∏ –Ω–∏–∂–µ. –ö–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞ –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ —Ñ–∞–π–ª <code>C:\whisper_hotkey\hotkey_whisper.py</code>.</p>
            
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4" id="cfg">
                    <div class="bg-gray-900/50 p-3 rounded-md"><label for="HOTKEY_KEY" class="block text-sm font-medium mb-1 text-gray-300">–ö–ª–∞–≤–∏—à–∞ –∑–∞–ø–∏—Å–∏</label><input type="text" id="HOTKEY_KEY" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white"></div>
                    <div class="bg-gray-900/50 p-3 rounded-md"><label for="WHISPER_MODEL" class="block text-sm font-medium mb-1 text-gray-300">–ú–æ–¥–µ–ª—å Whisper</label><select id="WHISPER_MODEL" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white"><option>tiny</option><option>base</option><option selected>small</option><option>medium</option><option>large</option></select></div>
                    <div class="bg-gray-900/50 p-3 rounded-md"><label for="LANGUAGE" class="block text-sm font-medium mb-1 text-gray-300">–Ø–∑—ã–∫</label><select id="LANGUAGE" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white"><option value="ru" selected>ru (–†—É—Å—Å–∫–∏–π)</option><option value="">auto (–ê–≤—Ç–æ)</option><option value="en">en (English)</option></select></div>
                    <div class="bg-gray-900/50 p-3 rounded-md"><label for="TASK" class="block text-sm font-medium mb-1 text-gray-300">–ó–∞–¥–∞—á–∞</label><select id="TASK" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white"><option value="transcribe" selected>–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ</option><option value="translate">–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ English</option></select></div>
                    <div class="bg-gray-900/50 p-3 rounded-md"><label for="INPUT_DEVICE" class="block text-sm font-medium mb-1 text-gray-300">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤–≤–æ–¥–∞</label><input type="text" id="INPUT_DEVICE" placeholder="–ø—É—Å—Ç–æ = –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white"></div>
                    <div class="bg-gray-900/50 p-3 rounded-md"><label for="MAX_RECORD_SEC" class="block text-sm font-medium mb-1 text-gray-300">–ú–∞–∫—Å. –∑–∞–ø–∏—Å—å, —Å–µ–∫</label><input type="number" id="MAX_RECORD_SEC" min="5" max="600" step="1" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white"></div>
                    <div class="bg-gray-900/50 p-3 rounded-md"><label for="SILENCE_THRESHOLD" class="block text-sm font-medium mb-1 text-gray-300">–ü–æ—Ä–æ–≥ —Ç–∏—à–∏–Ω—ã (0..1)</label><input type="number" id="SILENCE_THRESHOLD" min="0" max="1" step="0.005" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white"></div>
                    <div class="bg-gray-900/50 p-3 rounded-md"><label for="SILENCE_MARGIN_SEC" class="block text-sm font-medium mb-1 text-gray-300">–ó–∞–ø–∞—Å –¥–æ/–ø–æ—Å–ª–µ, —Å–µ–∫</label><input type="number" id="SILENCE_MARGIN_SEC" min="0" max="1" step="0.05" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white"></div>
                    <div class="bg-gray-900/50 p-3 rounded-md"><label for="CHUNK_SEC" class="block text-sm font-medium mb-1 text-gray-300">–†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞, —Å–µ–∫</label><input type="number" id="CHUNK_SEC" min="0.05" max="1.0" step="0.05" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white"></div>
                    <div class="bg-gray-900/50 p-3 rounded-md flex items-center h-full"><label class="flex items-center text-sm"><input type="checkbox" id="USE_GPU" class="h-4 w-4 rounded border-gray-600 bg-gray-700 text-blue-600"> <span class="ml-2 text-gray-300">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GPU</span></label></div>
                    <div class="bg-gray-900/50 p-3 rounded-md flex items-center h-full"><label class="flex items-center text-sm"><input type="checkbox" id="SUPPRESS_HOTKEY" class="h-4 w-4 rounded border-gray-600 bg-gray-700 text-blue-600"> <span class="ml-2 text-gray-300">–ü–æ–¥–∞–≤–ª—è—Ç—å –∫–ª–∞–≤–∏—à—É</span></label></div>
                    <div class="bg-gray-900/50 p-3 rounded-md flex items-center h-full"><label class="flex items-center text-sm"><input type="checkbox" id="SILENCE_TRIM" class="h-4 w-4 rounded border-gray-600 bg-gray-700 text-blue-600"> <span class="ml-2 text-gray-300">–ü–æ–¥—Ä–µ–∑–∞—Ç—å —Ç–∏—à–∏–Ω—É</span></label></div>
                </div>
                 <button onclick="resetDefaults()" class="mt-4 text-sm bg-gray-600 hover:bg-gray-500 text-white px-3 py-2 rounded-md">–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ</button>
            </div>

            <div class="code-block bg-gray-800 rounded-lg shadow-lg mt-6">
                <div class="relative p-3 border-b border-gray-700 flex justify-between items-center">
                    <span class="text-sm font-medium text-gray-400">hotkey_whisper.py</span>
                    <button class="copy-btn p-1.5 rounded-full bg-gray-700 hover:bg-gray-600">
                        <svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                    </button>
                </div>
                <pre class="p-4 text-sm" style="height: 110px;"><code id="pycode" class="language-python"></code></pre>
                <div class="resize-handle"></div>
            </div>
        </section>

        <section id="install-and-run" class="page-section hidden">
            <h2 class="text-2xl font-bold border-b border-gray-700 pb-2 mb-4">1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∑–∞–ø—É—Å–∫ whisper</h2>
            <p class="mb-4 text-gray-300">–ü–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∏–∂–µ. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –¥–≤—É—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è PyTorch (–¥–ª—è GPU –∏–ª–∏ CPU).</p>
            <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-gray-800 rounded-lg p-4"><span class="font-semibold text-white">1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ pip</span><div class="relative mt-2 bg-gray-900 rounded p-2"><button class="copy-btn absolute top-2 right-2 p-1.5 rounded-full bg-gray-700 hover:bg-gray-600"><svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button><pre class="text-sm"><code>pip install --upgrade pip</code></pre></div></div>
                <div class="bg-gray-800 rounded-lg p-4"><span class="font-semibold text-white">2. PyTorch –¥–ª—è GPU (CUDA 12.1)</span><div class="relative mt-2 bg-gray-900 rounded p-2"><button class="copy-btn absolute top-2 right-2 p-1.5 rounded-full bg-gray-700 hover:bg-gray-600"><svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button><pre class="text-sm"><code>pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121</code></pre></div></div>
                <div class="bg-gray-800 rounded-lg p-4"><span class="font-semibold text-white">2. PyTorch —Ç–æ–ª—å–∫–æ –¥–ª—è CPU</span><div class="relative mt-2 bg-gray-900 rounded p-2"><button class="copy-btn absolute top-2 right-2 p-1.5 rounded-full bg-gray-700 hover:bg-gray-600"><svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button><pre class="text-sm"><code>pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu</code></pre></div></div>
                <div class="bg-gray-800 rounded-lg p-4"><span class="font-semibold text-white">3. –û—Å–Ω–æ–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏</span><div class="relative mt-2 bg-gray-900 rounded p-2"><button class="copy-btn absolute top-2 right-2 p-1.5 rounded-full bg-gray-700 hover:bg-gray-600"><svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button><pre class="text-sm"><code>pip install openai-whisper sounddevice keyboard pyperclip</code></pre></div></div>
                <div class="bg-gray-800 rounded-lg p-4"><span class="font-semibold text-white">4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç</span><div class="relative mt-2 bg-gray-900 rounded p-2"><button class="copy-btn absolute top-2 right-2 p-1.5 rounded-full bg-gray-700 hover:bg-gray-600"><svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button><pre class="text-sm"><code>python hotkey_whisper.py</code></pre></div></div>
            </div>

            <h2 class="text-2xl font-bold border-b border-gray-700 pb-2 mb-4 mt-8">2. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ Whisper</h2>
            <p class="mb-4 text-gray-300">–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤–∞–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—ã –æ–¥–∏–Ω —Ä–∞–∑ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –æ–Ω–∏ –Ω–∞–≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ <code>venv</code>. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ:</p>
            <div class="space-y-3">
                <p class="text-gray-300">1. –û—Ç–∫—Ä–æ–π—Ç–µ PowerShell –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–±–æ—á—É—é –ø–∞–ø–∫—É:</p>
                <div class="relative bg-gray-800 rounded-lg p-4"><button class="copy-btn absolute top-2 right-2 p-1.5 rounded-full bg-gray-700 hover:bg-gray-600"><svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button><pre><code>Set-Location C:\whisper_hotkey</code></pre></div>
                <p class="text-gray-300">2. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:</p>
                <div class="relative bg-gray-800 rounded-lg p-4"><button class="copy-btn absolute top-2 right-2 p-1.5 rounded-full bg-gray-700 hover:bg-gray-600"><svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button><pre><code>.\venv\Scripts\Activate.ps1</code></pre></div>
                <p class="text-gray-300">3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:</p>
                <div class="relative bg-gray-800 rounded-lg p-4"><button class="copy-btn absolute top-2 right-2 p-1.5 rounded-full bg-gray-700 hover:bg-gray-600"><svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button><pre><code>python hotkey_whisper.py</code></pre></div>
            </div>
        </section>
        
        <section id="faq" class="page-section hidden">
            <h2 class="text-2xl font-bold border-b border-gray-700 pb-2 mb-4">3. –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ —Ä–µ—à–µ–Ω–∏—è</h2>
            <div class="space-y-4">
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h3 class="font-semibold text-white">–ö–ª–∞–≤–∏—à–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ –Ω–µ –ø–æ–¥–∞–≤–ª—è–µ—Ç—Å—è?</h3>
                    <p class="text-gray-400">–ó–∞–ø—É—Å—Ç–∏—Ç–µ PowerShell "–æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞" –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ –æ–ø—Ü–∏—é "–ü–æ–¥–∞–≤–ª—è—Ç—å –∫–ª–∞–≤–∏—à—É" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–∫—Ä–∏–ø—Ç–∞.</p>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h3 class="font-semibold text-white">–°–∫—Ä–∏–ø—Ç –º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ CPU?</h3>
                    <p class="text-gray-400">–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å `base` –∏–ª–∏ `tiny`. –û–Ω–∏ –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–º–∏.</p>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h3 class="font-semibold text-white">–†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è –ø—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç –∏–ª–∏ —Ä–µ—á—å –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è?</h3>
                    <p class="text-gray-400">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–º–µ–Ω—å—à–∏—Ç—å "–ü–æ—Ä–æ–≥ —Ç–∏—à–∏–Ω—ã" (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ `0.01`) –∏–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å "–ó–∞–ø–∞—Å –¥–æ/–ø–æ—Å–ª–µ —Ä–µ—á–∏".</p>
                </div>
            </div>
        </section>

    </main>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- –õ–û–ì–ò–ö–ê –ù–ê–í–ò–ì–ê–¶–ò–ò SPA ---
        const sections = document.querySelectorAll('.page-section');
        const navLinks = document.querySelectorAll('.nav-link');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        function showSection(targetId) {
            sections.forEach(section => {
                section.classList.toggle('hidden', section.id !== targetId);
            });
            navLinks.forEach(link => {
                link.classList.toggle('active', link.dataset.target === targetId);
            });
            mobileMenu.classList.add('hidden');
        }

        function navigate(event) {
            event.preventDefault();
            const targetId = event.currentTarget.dataset.target;
            history.pushState({ section: targetId }, '', `#${targetId}`);
            showSection(targetId);
            window.scrollTo(0, 0);
        }

        window.addEventListener('popstate', (event) => {
            const targetId = event.state ? event.state.section : 'home';
            showSection(targetId);
        });
        
        const initialTarget = location.hash.substring(1) || 'home';
        history.replaceState({ section: initialTarget }, '', `#${initialTarget}`);
        showSection(initialTarget);
        
        navLinks.forEach(link => link.addEventListener('click', navigate));
        document.querySelectorAll('.nav-link-header').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = 'home';
                history.pushState({ section: targetId }, '', `#${targetId}`);
                showSection(targetId);
                window.scrollTo(0, 0);
            });
        });

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // --- –õ–û–ì–ò–ö–ê –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø ---
        document.querySelectorAll('.copy-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const btn = e.currentTarget;
                const pre = btn.closest('.code-block, .relative').querySelector('pre');
                if (pre) {
                    navigator.clipboard.writeText(pre.innerText).then(() => {
                        const originalContent = btn.innerHTML;
                        btn.innerHTML = `<svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;
                        setTimeout(() => { btn.innerHTML = originalContent; }, 2000);
                    });
                }
            });
        });

        // --- –õ–û–ì–ò–ö–ê RESIZE –î–õ–Ø –ë–õ–û–ö–û–í –ö–û–î–ê ---
        document.querySelectorAll('.resize-handle').forEach(handle => {
            let preElement;
            let startY;
            let startHeight;

            function onMouseMove(e) {
                const dy = e.clientY - startY;
                preElement.style.height = `${startHeight + dy}px`;
            }

            function onMouseUp() {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            }

            handle.addEventListener('mousedown', (e) => {
                preElement = handle.previousElementSibling;
                startY = e.clientY;
                startHeight = parseInt(document.defaultView.getComputedStyle(preElement).height, 10);
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            });
        });

        // --- –õ–û–ì–ò–ö–ê –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–û–ì–û –ì–ï–ù–ï–†–ê–¢–û–†–ê –°–ö–†–ò–ü–¢–ê ---
        const defaults = {
            HOTKEY_KEY: 'f9', SUPPRESS_HOTKEY: true, MAX_RECORD_SEC: 60, WHISPER_MODEL: 'small',
            USE_GPU: true, LANGUAGE: 'ru', TASK: 'transcribe', INPUT_DEVICE: '',
            CHUNK_SEC: 0.2, SILENCE_TRIM: true, SILENCE_THRESHOLD: 0.015, SILENCE_MARGIN_SEC: 0.15
        };
        
        function pyBool(v) { return v ? 'True' : 'False'; }
        function pyString(v) { return v ? `'${v}'` : 'None'; }
        function pyInputDevice(v) {
            if (!v) return 'None';
            const n = Number(v);
            return Number.isFinite(n) && String(n) === v ? v : `'${v.replace(/'/g, "\\'")}'`;
        }
        
        function getCfg() {
            return Object.keys(defaults).reduce((acc, key) => {
                const el = document.getElementById(key);
                if (el) {
                    if (el.type === 'checkbox') acc[key] = el.checked;
                    else if (el.type === 'number') acc[key] = Number(el.value) || defaults[key];
                    else acc[key] = el.value.trim();
                }
                return acc;
            }, {});
        }

        function generateCode() {
            const c = getCfg();
            const fullCode = `import time, threading, queue
import numpy as np
import sounddevice as sd
import keyboard
import pyperclip
import whisper
import torch

try:
    import torchaudio.functional as AF
except ImportError:
    AF = None

try:
    import winsound
    HAVE_WINSOUND = True
except ImportError:
    HAVE_WINSOUND = False

#####################################################################
# –ù–ê–°–¢–†–û–ô–ö–ò
HOTKEY_KEY = '${c.HOTKEY_KEY.replace(/'/g, "\\'")}'
SUPPRESS_HOTKEY = ${pyBool(c.SUPPRESS_HOTKEY)}
MAX_RECORD_SEC = ${c.MAX_RECORD_SEC}
WHISPER_MODEL = '${c.WHISPER_MODEL}'
USE_GPU = ${pyBool(c.USE_GPU)}
LANGUAGE = ${pyString(c.LANGUAGE)}
TASK = '${c.TASK}'
INPUT_DEVICE = ${pyInputDevice(c.INPUT_DEVICE)}
CHUNK_SEC = ${c.CHUNK_SEC}
SILENCE_TRIM = ${pyBool(c.SILENCE_TRIM)}
SILENCE_THRESHOLD = ${c.SILENCE_THRESHOLD}
SILENCE_MARGIN_SEC = ${c.SILENCE_MARGIN_SEC}
#####################################################################

device = 'cuda' if (USE_GPU and torch.cuda.is_available()) else 'cpu'
if USE_GPU and device != 'cuda':
    print('‚ö†Ô∏è CUDA –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –°–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CPU.')

print(f"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ '{WHISPER_MODEL}' –Ω–∞ {device.upper()}...")
model = whisper.load_model(WHISPER_MODEL, device=device)
print("–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.")

_recording = False
_audio_queue = queue.Queue()
_stop_event = threading.Event()
_state_lock = threading.Lock()
_processing_lock = threading.Lock()

def beep(kind='start'):
    if not HAVE_WINSOUND: return
    tones = {'start': (880, 120), 'stop': (660, 120), 'ok': (1200, 120), 'err': (330, 220)}
    f, d = tones.get(kind, (750, 80))
    try: winsound.Beep(f, d)
    except Exception: pass

def get_input_samplerate(device=None):
    try:
        info = sd.query_devices(device, 'input')
        return int(info['default_samplerate'])
    except Exception:
        return 16000

def record_audio(q, stop_event, sr, device):
    try:
        block_size = max(1, int(sr * CHUNK_SEC))
        with sd.InputStream(samplerate=sr, channels=1, dtype='float32', device=device, blocksize=block_size) as stream:
            start_t = time.time()
            while not stop_event.is_set() and (time.time() - start_t) < MAX_RECORD_SEC:
                data, _ = stream.read(block_size)
                q.put(data.reshape(-1).copy())
    except Exception as e:
        q.put(('__ERROR__', str(e)))

def process_and_transcribe(audio_queue, sr_in):
    if not _processing_lock.acquire(blocking=False): 
        print("‚ÑπÔ∏è –ü—Ä–µ–¥—ã–¥—É—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.")
        return
    try:
        chunks, err = [], None
        while not audio_queue.empty():
            item = audio_queue.get_nowait();
            if isinstance(item, tuple) and item[0] == '__ERROR__': err = item[1]; break
            chunks.append(item)
        
        if err: print(f'‚ùå –ê—É–¥–∏–æ –æ—à–∏–±–∫–∞: {err}'); beep('err'); return
        if not chunks: print('‚ÑπÔ∏è –ù–∏—á–µ–≥–æ –Ω–µ –∑–∞–ø–∏—Å–∞–Ω–æ.'); return
        
        audio = np.concatenate(chunks, axis=0)
        
        if SILENCE_TRIM and audio.size > 0:
            win_size = int(0.05 * sr_in)
            if win_size == 0: win_size = 1
            env = np.convolve(np.abs(audio), np.ones(win_size)/win_size, 'same')
            mask = env >= SILENCE_THRESHOLD
            if np.any(mask):
                idx = np.where(mask)[0]
                start = max(0, idx[0] - int(SILENCE_MARGIN_SEC * sr_in))
                end = min(audio.size, idx[-1] + int(SILENCE_MARGIN_SEC * sr_in))
                audio = audio[start:end]
            else: audio = np.array([], dtype=np.float32)

        if audio.size < 200: print('‚ÑπÔ∏è –ó–∞–ø–∏—Å—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∞—è –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Ç–∏—à–∏–Ω—ã.'); return
        
        if sr_in != 16000:
            target_sr = 16000
            if AF:
                tensor = torch.from_numpy(audio).unsqueeze(0)
                audio = AF.resample(tensor, sr_in, target_sr).squeeze(0).numpy()
            else:
                n_out = int(round(audio.size * (target_sr / float(sr_in))))
                x_old = np.linspace(0.0, 1.0, num=audio.size)
                x_new = np.linspace(0.0, 1.0, num=n_out)
                audio = np.interp(x_new, x_old, audio)
        
        print('üõ† –†–∞—Å–ø–æ–∑–Ω–∞—ë–º...')
        result = model.transcribe(audio.astype(np.float32), fp16=(device == 'cuda'), language=LANGUAGE, task=TASK)
        text = result.get('text', '').strip()

        if text:
            pyperclip.copy(text)
            keyboard.write(text)
            print('üî§ –†–µ–∑—É–ª—å—Ç–∞—Ç:', text)
            beep('ok')
        else:
            print('‚ÑπÔ∏è –†–∞—Å–ø–æ–∑–Ω–∞–Ω –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.')

    except Exception as e:
        print(f'‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: {e}'); beep('err')
    finally:
        _processing_lock.release()

def start_recording(_event=None):
    global _recording, _audio_queue, _stop_event
    with _state_lock:
        if _recording: return
        _recording = True
        _audio_queue = queue.Queue()
        _stop_event = threading.Event()
        sr_in = get_input_samplerate(INPUT_DEVICE)
        
        threading.Thread(target=record_audio, args=(_audio_queue, _stop_event, sr_in, INPUT_DEVICE), daemon=True).start()
        print(f'‚ñ∂Ô∏è –ó–∞–ø–∏—Å—å...')
        beep('start')

def stop_recording(_event=None):
    with _state_lock:
        if not _recording: return
        _recording = False
    
    _stop_event.set()
    beep('stop')
    
    sr_in = get_input_samplerate(INPUT_DEVICE)
    threading.Thread(target=process_and_transcribe, args=(_audio_queue, sr_in), daemon=True).start()

def main():
    print('--- –ì–æ—Ä—è—á–∞—è –¥–∏–∫—Ç–æ–≤–∫–∞ —Å Whisper ---')
    print(f'–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ "{HOTKEY_KEY.upper()}" –¥–ª—è –∑–∞–ø–∏—Å–∏')
    
    keyboard.on_press_key(HOTKEY_KEY, start_recording, suppress=SUPPRESS_HOTKEY)
    keyboard.on_release_key(HOTKEY_KEY, stop_recording, suppress=SUPPRESS_HOTKEY)

    try:
        while True: time.sleep(1)
    except KeyboardInterrupt:
        print('\\n–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...')
    finally:
        keyboard.unhook_all()

if __name__ == '__main__':
    main()
`;
            document.getElementById('pycode').textContent = fullCode;
        }

        window.resetDefaults = function() {
            Object.keys(defaults).forEach(key => {
                const el = document.getElementById(key);
                if (el) {
                    if (el.type === 'checkbox') el.checked = defaults[key];
                    else el.value = defaults[key];
                }
            });
            generateCode();
        }

        document.getElementById('cfg').addEventListener('input', generateCode);
        resetDefaults();
    });
    </script>
</body>
</html>
